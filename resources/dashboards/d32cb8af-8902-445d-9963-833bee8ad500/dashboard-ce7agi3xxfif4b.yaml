apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: d32cb8af-8902-445d-9963-833bee8ad500
    name: ce7agi3xxfif4b
spec:
    __elements: {}
    __inputs:
        - description: ""
          label: Scout DS
          name: DS_ScoutAltCH
          pluginId: vertamedia-clickhouse-datasource
          pluginName: Altinity plugin for ClickHouse
          type: datasource
        - description: ""
          label: Expression
          name: DS_EXPRESSION
          pluginId: __expr__
          type: datasource
    __requires:
        - id: __expr__
          type: datasource
          version: 1.0.0
        - id: barchart
          name: Bar chart
          type: panel
          version: ""
        - id: grafana
          name: Grafana
          type: grafana
          version: 11.3.0
        - id: stat
          name: Stat
          type: panel
          version: ""
        - id: timeseries
          name: Time series
          type: panel
          version: ""
        - id: vertamedia-clickhouse-datasource
          name: Altinity plugin for ClickHouse
          type: datasource
          version: 3.2.4
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: grafana
                uid: -- Grafana --
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 0
    links: []
    panels:
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: points
                    fillOpacity: 0
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        log: 2
                        type: log
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 7
            w: 24
            x: 0
            "y": 0
          id: 4
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          targets:
            - adHocFilters: []
              add_metadata: true
              database: system
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: event_time_microseconds
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: "-- Outermost query: Calculates rate of queries\nSELECT\n    t,  -- Timestamp (binned)\n    arrayMap(a -> (a.1, a.2 / runningDifference(t / 1000)), groupArr)\n    -- Transforms grouped data, calculating a rate/difference\n\nFROM (\n    -- Middle query: Groups queries by timestamp\n    SELECT \n        t, \n        groupArray((q, c)) AS groupArr\n    \n    FROM (\n        -- Inner (lowest) query: Fetches and preprocesses query log data\n        SELECT\n            (intDiv(toUInt32(event_time), 2) * 2) * 1000 AS t,  -- Time binning\n            normalizeQuery(query) AS q,  -- Normalize queries\n            count() c  -- Count queries\n        FROM cluster('default', system.query_log)\n        \n        -- Multiple conditional filters:\n        WHERE $timeFilter\n --       AND (\n --           ('$type' = '1,2,3,4' AND type != 'QueryStart') \n --           OR \n --           ('$type' != '1,2,3,4' AND type IN ($type))\n --       )\n        -- Conditional tests for query kind, user, duration\n  --      $conditionalTest(AND query_kind IN ($query_kind), $query_kind)\n--        $conditionalTest(AND initial_user IN ($user), $user)\n        AND query_duration_ms >= 500\n        AND query_duration_ms <= 100000\n        \n        -- Subquery to filter most frequent query hashes\n        AND normalized_query_hash GLOBAL IN (\n            SELECT \n                normalized_query_hash AS h\n            FROM cluster('default', system.query_log)\n            -- Similar filtering conditions as above\n            WHERE $timeFilter\n            -- ... (similar filtering)\n            GROUP BY h\n            ORDER BY count() DESC\n            LIMIT 100\n            SETTINGS skip_unavailable_shards=1\n        )\n        \n        GROUP BY t, query\n        ORDER BY t\n    )\n    \n    GROUP BY t\n    ORDER BY t\n) \n"
              rawQuery: "/* grafana dashboard=Clichouse Monitor, user=1 */\n\nSELECT\n    t,  \n    arrayMap(a -> (a.1, a.2 / runningDifference(t / 1000)), groupArr)\n    \n\nFROM (\n    \n    SELECT \n        t, \n        groupArray((q, c)) AS groupArr\n    \n    FROM (\n        \n        SELECT\n            (intDiv(toUInt32(event_time), 2) * 2) * 1000 AS t,  \n            normalizeQuery(query) AS q,  \n            count() c  \n        FROM cluster('default', system.query_log)\n        \n        \n        WHERE event_time_microseconds >= toDateTime64(1734532335, 3) AND event_time_microseconds <= toDateTime64(1734543135, 3)\n \n \n \n \n \n        \n  \n\n        AND query_duration_ms >= 00\n        AND query_duration_ms <= 100000\n        \n        \n        AND normalized_query_hash GLOBAL IN (\n            SELECT \n                normalized_query_hash AS h\n            FROM cluster('default', system.query_log)\n            \n            WHERE event_time_microseconds >= toDateTime64(1734532335, 3) AND event_time_microseconds <= toDateTime64(1734543135, 3)\n            \n            GROUP BY h\n            ORDER BY count() DESC\n            LIMIT 100\n            SETTINGS skip_unavailable_shards=1\n        )\n        \n        GROUP BY t, query\n        ORDER BY t\n    )\n    \n    GROUP BY t\n    ORDER BY t\n)"
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: query_log
          title: Rate of queries
          type: timeseries
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                unit: s
            overrides: []
          gridPos:
            h: 7
            w: 24
            x: 0
            "y": 7
          id: 1
          maxPerRow: 6
          options:
            colorMode: value
            graphMode: none
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - last
                fields: ""
                values: false
            showPercentChange: false
            textMode: auto
            wideLayout: true
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: Timestamp
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: "60"
              intervalFactor: 1
              query: "SELECT \n    ServiceName,\n    MetricName,\n    TimeUnix,\n    Value\nFROM $table\nWHERE \n    MetricName = 'chi_clickhouse_metric_Uptime'\n    AND Attributes['hostname'] LIKE '$unescape($hostname)'\nORDER BY TimeUnix DESC limit 1"
              rawQuery: "/* grafana dashboard=Clichouse Monitor, user=1 */\nSELECT \n    ServiceName,\n    MetricName,\n    TimeUnix,\n    Value\nFROM default.otel_metrics_gauge\nWHERE \n    MetricName = 'chi_clickhouse_metric_Uptime'\n    AND Attributes['hostname'] LIKE 'chi-clickhouse-default-3-0.default.svc.cluster.local'\nORDER BY TimeUnix DESC limit"
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: otel_metrics_gauge
          title: Uptime $hostname
          type: stat
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: continuous-greens
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    fillOpacity: 50
                    gradientMode: hue
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    lineWidth: 1
                    scaleDistribution:
                        type: linear
                    thresholdsStyle:
                        mode: "off"
                displayName: Memory for Queries
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                unit: bytes
            overrides: []
          gridPos:
            h: 9
            w: 24
            x: 0
            "y": 14
          id: 3
          maxPerRow: 6
          options:
            barRadius: 0
            barWidth: 0.97
            fullHighlight: false
            groupWidth: 0.7
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            orientation: vertical
            showValue: auto
            stacking: none
            tooltip:
                mode: single
                sort: none
            xTickLabelRotation: 0
            xTickLabelSpacing: 100
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryTracking'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (30 * 1000)) * (30 * 1000)) as t, Value FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734522221, 3) AND TimeUnix <= toDateTime64(1734543821, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryTracking'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
          title: Memory for Queries $hostname
          type: barchart
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisGridShow: true
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: points
                    fillOpacity: 0
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 3
                    scaleDistribution:
                        log: 10
                        type: log
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
                unit: bytes
            overrides: []
          gridPos:
            h: 10
            w: 24
            x: 0
            "y": 23
          id: 7
          maxPerRow: 6
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryCode FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryCode'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as  FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540374, 3) AND TimeUnix <= toDateTime64(1734543974, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryCode'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryResident FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryResident'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as  FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540374, 3) AND TimeUnix <= toDateTime64(1734543974, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryResident'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryShared FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryShared'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as  FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540374, 3) AND TimeUnix <= toDateTime64(1734543974, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryShared'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: C
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryDataAndStack FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryDataAndStack'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as  FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540374, 3) AND TimeUnix <= toDateTime64(1734543974, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryDataAndStack'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: D
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryVirtual FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryVirtual'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as  FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540374, 3) AND TimeUnix <= toDateTime64(1734543974, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryVirtual'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: E
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
          title: Memory Stats $hostname
          type: timeseries
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    fillOpacity: 80
                    gradientMode: hue
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    lineWidth: 1
                    scaleDistribution:
                        type: linear
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                thresholds:
                    mode: percentage
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
                unit: percentunit
            overrides: []
          gridPos:
            h: 10
            w: 24
            x: 0
            "y": 33
          id: 10
          maxPerRow: 6
          options:
            barRadius: 0
            barWidth: 0.97
            fullHighlight: false
            groupWidth: 0.7
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            orientation: vertical
            showValue: auto
            stacking: none
            tooltip:
                mode: single
                sort: none
            xTickLabelRotation: 0
            xTickLabelSpacing: 100
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: true
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as DiskDataBytes FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskDataBytes'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as DiskDatBytes FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734541929, 3) AND TimeUnix <= toDateTime64(1734545529, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskDataBytes'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: true
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as DiskFreeBytes FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskFreeBytes'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value DiskFreeBytes FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734541929, 3) AND TimeUnix <= toDateTime64(1734545529, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskFreeBytes'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - datasource:
                type: __expr__
                uid: ${DS_EXPRESSION}
              expression: $A/($A + $B)
              hide: false
              refId: C
              type: math
          title: Disk Usage
          type: barchart
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: line
                    fillOpacity: 0
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        type: linear
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: "off"
                displayName: Disk Usage
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
                unit: percentunit
            overrides: []
          gridPos:
            h: 0
            w: 24
            x: 0
            "y": 43
          id: 9
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: true
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as DiskDataBytes FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskDataBytes'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as DiskDataBytes FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734541406, 3) AND TimeUnix <= toDateTime64(1734545006, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskDataBytes'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: true
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as MemoryResident FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskFreeBytes'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as MemoryResident FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734541406, 3) AND TimeUnix <= toDateTime64(1734545006, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_DiskFreeBytes'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - datasource:
                type: __expr__
                uid: ${DS_EXPRESSION}
              expression: $A/($A+$B)
              hide: false
              refId: C
              type: math
          title: Disk Usage $hostname
          type: timeseries
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisGridShow: true
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: bars
                    fillOpacity: 0
                    gradientMode: hue
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineStyle:
                        fill: solid
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        type: linear
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                unit: bytes
            overrides: []
          gridPos:
            h: 8
            w: 24
            x: 0
            "y": 43
          id: 8
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as PrimaryKeyBytesAllocated FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryPrimaryKeyBytesAllocated'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (10 * 1000)) * (10 * 1000)) as t, Value as MemoryCode FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540881, 3) AND TimeUnix <= toDateTime64(1734544481, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryPrimaryKeyBytesAllocated'
                AND Attributes['hostname'] = 'chi-clickhouse-default-3-0.default.svc.cluster.local'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as DictionaryBytesAllocated FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryDictionaryBytesAllocated'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as MemoryResident FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734540881, 3) AND TimeUnix <= toDateTime64(1734544481, 3)
                AND ServiceName='clickhouse'
                AND MetricName='chi_clickhouse_metric_MemoryDictionaryBytesAllocated'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
          title: Memory Occupied $hostname
          type: timeseries
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: points
                    fillOpacity: 0
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        type: linear
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: dashed
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 10
            w: 24
            x: 0
            "y": 51
          id: 5
          maxPerRow: 6
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as TCP FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_TCPConnection'
                AND Attributes['hostname'] = '$unescape($hostname)'

                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as TCPConnections FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734740380, 3) AND TimeUnix <= toDateTime64(1734742180, 3)
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_TCPConnection'
                AND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'

                ORDER BY t
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as HTTP FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_HTTPConnection'
                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as HTT FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734740380, 3) AND TimeUnix <= toDateTime64(1734742180, 3)
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_HTTPConnection'
                ORDER BY t
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: |-
                SELECT $timeSeries as t, Value as InterServer FROM $table WHERE
                $timeFilter
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_InterserverConnection'
                ORDER BY t
              rawQuery: |-
                /* grafana dashboard=Clichouse Monitor, user=1 */
                SELECT (intDiv(toFloat64(TimeUnix) * 1000, (2 * 1000)) * (2 * 1000)) as t, Value as InterServe FROM default.otel_metrics_gauge WHERE
                TimeUnix >= toDateTime64(1734740380, 3) AND TimeUnix <= toDateTime64(1734742180, 3)
                AND ServiceName='clickhouse'
                AND MetricName = 'chi_clickhouse_metric_InterserverConnection'
                ORDER BY t
              refId: C
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
          title: Connections $hostname
          type: timeseries
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: auto
                    barAlignment: -1
                    barWidthFactor: 0.6
                    drawStyle: points
                    fillOpacity: 0
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        type: linear
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: none
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 0
            w: 24
            x: 0
            "y": 61
          id: 6
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                mode: single
                sort: none
          pluginVersion: 11.3.0
          repeat: hostname
          repeatDirection: h
          targets:
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              query: "SELECT $timeSeries as t, Value AS ActiveParts FROM $table WHERE\n$timeFilter\nAND ServiceName='clickhouse'\nAND MetricName = 'chi_clickhouse_table_parts' \nAND Attributes['active'] = '1'\nAND Attributes['hostname'] = '$unescape($hostname)'\nORDER BY t"
              rawQuery: "/* grafana dashboard=Clichouse Monitor, user=1 */\nSELECT (intDiv(toFloat64(TimeUnix) * 1000, (30 * 1000)) * (30 * 1000)) as t, Value AS ActiveParts FROM default.otel_metrics_gauge WHERE\nTimeUnix >= toDateTime64(1734522221, 3) AND TimeUnix <= toDateTime64(1734543821, 3)\nAND ServiceName='clickhouse'\nAND MetricName = 'chi_clickhouse_table_parts' \nAND Attributes['active'] = '1'\nAND Attributes['hostname'] = 'chi-clickhouse-default-0-0.default.svc.cluster.local'\nORDER BY t"
              refId: A
              round: 0s
              showFormattedSQL: false
              skip_comments: true
              table: otel_metrics_gauge
            - adHocFilters: []
              add_metadata: true
              database: default
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: time_series
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              query: "SELECT $timeSeries as t, Value as InactiveParts FROM $table WHERE\n$timeFilter\nAND ServiceName='clickhouse'\nAND MetricName = 'chi_clickhouse_table_parts' \nAND Attributes['active'] = '0'\nORDER BY t"
              rawQuery: "/* grafana dashboard=Clichouse Monitor, user=1 */\nSELECT (intDiv(toFloat64(TimeUnix) * 1000, (5 * 1000)) * (5 * 1000)) as t, Value as InactiveParts' FROM default.otel_metrics_gauge WHERE\nTimeUnix >= toDateTime64(1734539612, 3) AND TimeUnix <= toDateTime64(1734543212, 3)\nAND ServiceName='clickhouse'\nAND MetricName = 'chi_clickhouse_table_parts' \nAND Attributes['active'] = '0'\nORDER BY t"
              refId: B
              round: 0s
              skip_comments: true
              table: otel_metrics_gauge
          title: Parts $hostname
          type: timeseries
    schemaVersion: 40
    tags: []
    templating:
        list:
            - current: {}
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              definition: 'SELECT distinct Attributes[''hostname'']  FROM otel_metrics_gauge_local where ServiceName=''clickhouse'' and MetricName=''chi_clickhouse_metric_Uptime'' '
              label: Host
              multi: true
              name: hostname
              options: []
              query: 'SELECT distinct Attributes[''hostname'']  FROM otel_metrics_gauge_local where ServiceName=''clickhouse'' and MetricName=''chi_clickhouse_metric_Uptime'' '
              refresh: 1
              regex: ""
              type: query
    time:
        from: now-30m
        to: now
    timepicker: {}
    timezone: browser
    title: Clichouse Monitor
    uid: ce7agi3xxfif4b
    weekStart: ""
