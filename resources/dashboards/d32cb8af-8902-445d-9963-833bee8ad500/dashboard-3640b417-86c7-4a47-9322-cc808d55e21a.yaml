apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: d32cb8af-8902-445d-9963-833bee8ad500
    name: 3640b417-86c7-4a47-9322-cc808d55e21a
spec:
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: grafana
                uid: -- Grafana --
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 0
    links: []
    panels:
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
            overrides: []
          gridPos:
            h: 17
            w: 7
            x: 0
            "y": 0
          id: 3
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
          pluginVersion: 12.0.2+security-01
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: Timestamp
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: "SELECT\n    DISTINCT(ServiceName) as Service,\n    COUNT(DISTINCT(SpanName)) as NumberOfSpans \nFROM $table\nWHERE $timeFilter\nGROUP BY Service\nORDER BY NumberOfSpans DESC"
              rawQuery: "/* grafana dashboard='Traces Collected', user='6' */\nSELECT\n    DISTINCT(ServiceName) as Service,\n    COUNT(DISTINCT(SpanName)) as NumberOfSpans \nFROM base14.otel_traces\nWHERE Timestamp >= toDateTime64(1753351014,3) AND Timestamp <= toDateTime64(1753351314,3)\nGROUP BY Service\nORDER BY NumberOfSpans DESC"
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: otel_traces
              useWindowFuncForMacros: true
          title: Unique Spans by Service
          type: table
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    fixedColor: dark-blue
                    mode: palette-classic
                custom:
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                mappings: []
            overrides: []
          gridPos:
            h: 17
            w: 9
            x: 7
            "y": 0
          id: 4
          options:
            displayLabels:
                - name
            legend:
                displayMode: list
                placement: bottom
                showLegend: true
                values:
                    - value
            pieType: donut
            reduceOptions:
                calcs:
                    - lastNotNull
                fields: ""
                values: true
            tooltip:
                hideZeros: false
                mode: single
                sort: none
          pluginVersion: 12.0.2+security-01
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: Timestamp
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: "SELECT\n    DISTINCT(ServiceName) AS Service,\n    COUNT(SpanName) AS NumberOfSpans \nFROM $table\nWHERE $timeFilter\nGROUP BY Service\nORDER BY NumberOfSpans DESC"
              rawQuery: "/* grafana dashboard='Traces Collected', user='6' */\nSELECT\n    DISTINCT(ServiceName) AS Service,\n    COUNT(SpanName) AS NumberOfSpans \nFROM base14.otel_traces\nWHERE Timestamp >= toDateTime64(1753351014,3) AND Timestamp <= toDateTime64(1753351314,3)\nGROUP BY Service\nORDER BY NumberOfSpans DESC"
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: otel_traces
              useWindowFuncForMacros: true
          title: Total Spans by Service
          type: piechart
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
            overrides:
                - matcher:
                    id: byName
                    options: ServiceName
                  properties:
                    - id: custom.width
                      value: 100
          gridPos:
            h: 17
            w: 8
            x: 16
            "y": 0
          id: 2
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
            sortBy: []
          pluginVersion: 12.0.2+security-01
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: Timestamp
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              hide: false
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: "SELECT DISTINCT SpanName, ServiceName \nFROM $table\nWHERE $timeFilter\nAND (ServiceName IS NOT NULL AND ServiceName in (${service:singlequote}))\nAND SpanName ilike '%${searchText:raw}%'\nORDER BY ServiceName, SpanName\nLIMIT 100"
              rawQuery: "/* grafana dashboard='Traces Collected', user='6' */\nSELECT DISTINCT SpanName, ServiceName \nFROM base14.otel_traces\nWHERE Timestamp >= toDateTime64(1753351014,3) AND Timestamp <= toDateTime64(1753351314,3)\nAND (ServiceName IS NOT NULL AND ServiceName in ())\nAND SpanName ilike '%%'\nORDER BY ServiceName, SpanName\nLIMIT 100"
              refId: A
              round: 0s
              showFormattedSQL: false
              skip_comments: true
              table: otel_traces
              useWindowFuncForMacros: true
          title: All Metrics by Type
          type: table
    preload: false
    schemaVersion: 41
    tags:
        - health
    templating:
        list:
            - allowCustomValue: false
              current:
                text: All
                value: $__all
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              definition: |-
                SELECT DISTINCT ServiceName
                FROM $table
                WHERE Timestamp > now() - INTERVAL 1 day
              description: ""
              includeAll: true
              label: Service
              multi: true
              name: service
              options: []
              query:
                adHocFilters: []
                adHocValuesQuery: ""
                add_metadata: true
                contextWindowSize: "10"
                database: base14
                datasourceMode: Variable
                dateTimeColDataType: Timestamp
                dateTimeType: DATETIME64
                editorMode: sql
                extrapolate: true
                format: time_series
                formattedQuery: |-
                    SELECT DISTINCT ServiceName
                    FROM base14.otel_traces
                    WHERE Timestamp > now() - INTERVAL 1 day
                interval: ""
                intervalFactor: 1
                nullifySparse: false
                query: |-
                    SELECT DISTINCT ServiceName
                    FROM $table
                    WHERE Timestamp > now() - INTERVAL 1 day
                rawQuery: |-
                    /* grafana dashboard='Traces Collected', user='6' */
                    SELECT DISTINCT ServiceName
                    FROM base14.otel_traces
                    WHERE Timestamp > now() - INTERVAL 1 day
                round: 0s
                skip_comments: true
                table: otel_traces
                useWindowFuncForMacros: true
              refresh: 1
              regex: ""
              type: query
            - current:
                text: ""
                value: ""
              label: Span Name
              name: searchText
              options:
                - selected: true
                  text: ""
                  value: ""
              query: ""
              type: textbox
    time:
        from: now-5m
        to: now
    timepicker: {}
    timezone: browser
    title: Traces Collected
    uid: 3640b417-86c7-4a47-9322-cc808d55e21a
