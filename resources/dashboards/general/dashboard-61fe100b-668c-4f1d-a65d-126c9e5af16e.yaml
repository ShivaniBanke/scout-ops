apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: general
    name: 61fe100b-668c-4f1d-a65d-126c9e5af16e
spec:
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: grafana
                uid: -- Grafana --
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 0
    links: []
    panels:
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: dark-blue
                          value: 0
            overrides:
                - matcher:
                    id: byName
                    options: Total
                  properties:
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: gauge
                        valueDisplayMode: text
                    - id: fieldMinMax
                      value: true
                    - id: custom.align
                      value: left
                - matcher:
                    id: byName
                    options: Logs
                  properties:
                    - id: custom.cellOptions
                      value:
                        type: json-view
                    - id: custom.width
                      value: 128
                - matcher:
                    id: byName
                    options: Metrics
                  properties:
                    - id: custom.cellOptions
                      value:
                        type: json-view
                    - id: custom.width
                      value: 131
                - matcher:
                    id: byName
                    options: Traces
                  properties:
                    - id: custom.cellOptions
                      value:
                        type: json-view
                    - id: custom.width
                      value: 135
                - matcher:
                    id: byName
                    options: ServiceName
                  properties:
                    - id: custom.width
                      value: 183
          gridPos:
            h: 7
            w: 19
            x: 0
            "y": 0
          id: 1
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: true
            showHeader: true
            sortBy: []
          pluginVersion: 12.1.0
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: "\nWITH telemetry_data AS (\n    SELECT \n        ServiceName,\n        MetricName,\n        argMin(Value, TimeUnix) as first_value,\n        argMax(Value, TimeUnix) as last_value,\n        argMax(Value, TimeUnix) - argMin(Value, TimeUnix) as delta_count  -- Delta for counter metrics\n    FROM base14.otel_metrics_sum\n    WHERE ServiceName LIKE '%-otel'  -- Services ending with 'otel'\n        AND $timeFilter\n        AND MetricName IN (\n            'otelcol_receiver_accepted_log_records',\n            'otelcol_receiver_accepted_metric_points', \n            'otelcol_receiver_accepted_spans'\n        )\n        AND ResourceAttributes['environment'] like '%production'\n    GROUP BY ServiceName, MetricName\n)\nSELECT \n    ServiceName,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_log_records' THEN delta_count ELSE 0 END) as Logs,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_metric_points' THEN delta_count ELSE 0 END) as Metrics,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_spans' THEN delta_count ELSE 0 END) as Traces,\n    sum(delta_count) as Total\nFROM telemetry_data\nGROUP BY ServiceName\nORDER BY Total DESC"
              rawQuery: "/* grafana dashboard='Client Activity', user='4' */\nWITH telemetry_data AS (\n    SELECT \n        ServiceName,\n        MetricName,\n        argMin(Value, TimeUnix) as first_value,\n        argMax(Value, TimeUnix) as last_value,\n        argMax(Value, TimeUnix) - argMin(Value, TimeUnix) as delta_count  \n    FROM base14.otel_metrics_sum\n    WHERE ServiceName LIKE '%-otel'  \n        AND TimeUnix >= toDateTime64(1753890730,3) AND TimeUnix <= toDateTime64(1753894330,3)\n        AND MetricName IN (\n            'otelcol_receiver_accepted_log_records',\n            'otelcol_receiver_accepted_metric_points', \n            'otelcol_receiver_accepted_spans'\n        )\n        AND ResourceAttributes['environment'] like '%production'\n    GROUP BY ServiceName, MetricName\n)\nSELECT \n    ServiceName,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_log_records' THEN delta_count ELSE 0 END) as Logs,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_metric_points' THEN delta_count ELSE 0 END) as Metrics,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_spans' THEN delta_count ELSE 0 END) as Traces,\n    sum(delta_count) as Total\nFROM telemetry_data\nGROUP BY ServiceName\nORDER BY Total DESC"
              refId: A
              round: 0s
              skip_comments: true
              table: otel_metrics_sum
              useWindowFuncForMacros: true
          title: Active Clients - Production
          type: table
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: 0
            overrides:
                - matcher:
                    id: byName
                    options: ServiceName
                  properties:
                    - id: custom.width
                      value: 183
                    - id: color
                      value:
                        fixedColor: dark-orange
                        mode: fixed
                    - id: custom.cellOptions
                      value:
                        type: color-text
          gridPos:
            h: 17
            w: 5
            x: 19
            "y": 0
          id: 4
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
            sortBy: []
          pluginVersion: 12.1.0
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: |4-
                SELECT DISTINCT ServiceName
                FROM base14.otel_metrics_gauge
                WHERE ServiceName LIKE '%-otel'
                AND TimeUnix > now() - interval 10 day
                AND ResourceAttributes['environment'] = 'playground'
                AND ServiceName NOT IN (
                    SELECT DISTINCT ServiceName
                    FROM $table
                    WHERE ServiceName LIKE '%-otel'
                    AND $timeFilter
                    AND MetricName = 'otelcol_processor_accepted_metric_points'
                    AND ResourceAttributes['environment'] = 'playground'
                )
                ORDER BY ServiceName
              rawQuery: |-
                /* grafana dashboard='Client Activity', user='2' */
                SELECT DISTINCT ServiceName
                FROM base14.otel_metrics_gauge
                WHERE ServiceName LIKE '%-otel'
                AND TimeUnix > now() - interval 10 day
                AND ResourceAttributes['environment'] = 'playground'
                AND ServiceName NOT IN (
                    SELECT DISTINCT ServiceName
                    FROM base14.otel_metrics_sum
                    WHERE ServiceName LIKE '%-otel'
                    AND TimeUnix >= toDateTime64(1752237708,3) AND TimeUnix <= toDateTime64(1752241308,3)
                    AND MetricName = 'otelcol_processor_accepted_metric_points'
                    AND ResourceAttributes['environment'] = 'playground'
                )
                ORDER BY ServiceName
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: otel_metrics_sum
              useWindowFuncForMacros: true
          title: Inactive Clients - Playground
          type: table
        - datasource:
            type: vertamedia-clickhouse-datasource
            uid: ds-scout-altinity-ch
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: blue
                          value: 0
            overrides:
                - matcher:
                    id: byName
                    options: Total
                  properties:
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: gauge
                        valueDisplayMode: text
                    - id: fieldMinMax
                      value: true
                    - id: custom.align
                      value: left
                - matcher:
                    id: byName
                    options: Logs
                  properties:
                    - id: custom.width
                      value: 128
                - matcher:
                    id: byName
                    options: Metrics
                  properties:
                    - id: custom.width
                      value: 131
                - matcher:
                    id: byName
                    options: Traces
                  properties:
                    - id: custom.width
                      value: 135
                - matcher:
                    id: byName
                    options: ServiceName
                  properties:
                    - id: custom.width
                      value: 183
          gridPos:
            h: 10
            w: 19
            x: 0
            "y": 7
          id: 2
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: true
            showHeader: false
            sortBy: []
          pluginVersion: 12.1.0
          targets:
            - adHocFilters: []
              adHocValuesQuery: ""
              add_metadata: true
              contextWindowSize: "10"
              database: base14
              datasource:
                type: vertamedia-clickhouse-datasource
                uid: ds-scout-altinity-ch
              dateTimeColDataType: TimeUnix
              dateTimeType: DATETIME64
              editorMode: sql
              extrapolate: true
              format: table
              formattedQuery: SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t
              interval: ""
              intervalFactor: 1
              nullifySparse: false
              query: "\nWITH telemetry_data AS (\n    SELECT \n        ServiceName,\n        MetricName,\n        argMin(Value, TimeUnix) as first_value,\n        argMax(Value, TimeUnix) as last_value,\n        argMax(Value, TimeUnix) - argMin(Value, TimeUnix) as delta_count  -- Delta for counter metrics\n    FROM base14.otel_metrics_sum\n    WHERE ServiceName LIKE '%-otel'  -- Services ending with 'otel'\n        AND $timeFilter\n        AND MetricName IN (\n            'otelcol_receiver_accepted_log_records',\n            'otelcol_receiver_accepted_metric_points', \n            'otelcol_receiver_accepted_spans'\n        )\n        AND ResourceAttributes['environment'] = 'playground'\n\n    GROUP BY ServiceName, MetricName\n)\nSELECT \n    ServiceName,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_log_records' THEN delta_count ELSE 0 END) as Logs,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_metric_points' THEN delta_count ELSE 0 END) as Metrics,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_spans' THEN delta_count ELSE 0 END) as Traces,\n    sum(delta_count) as Total\nFROM telemetry_data\nGROUP BY ServiceName\nORDER BY Total DESC"
              rawQuery: "/* grafana dashboard='Client Activity', user='4' */\nWITH telemetry_data AS (\n    SELECT \n        ServiceName,\n        MetricName,\n        argMin(Value, TimeUnix) as first_value,\n        argMax(Value, TimeUnix) as last_value,\n        argMax(Value, TimeUnix) - argMin(Value, TimeUnix) as delta_count  \n    FROM base14.otel_metrics_sum\n    WHERE ServiceName LIKE '%-otel'  \n        AND TimeUnix >= toDateTime64(1753807958,3) AND TimeUnix <= toDateTime64(1753894358,3)\n        AND MetricName IN (\n            'otelcol_receiver_accepted_log_records',\n            'otelcol_receiver_accepted_metric_points', \n            'otelcol_receiver_accepted_spans'\n        )\n        AND ResourceAttributes['environment'] = 'playground'\n\n    GROUP BY ServiceName, MetricName\n)\nSELECT \n    ServiceName,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_log_records' THEN delta_count ELSE 0 END) as Logs,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_metric_points' THEN delta_count ELSE 0 END) as Metrics,\n    sum(CASE WHEN MetricName = 'otelcol_receiver_accepted_spans' THEN delta_count ELSE 0 END) as Traces,\n    sum(delta_count) as Total\nFROM telemetry_data\nGROUP BY ServiceName\nORDER BY Total DESC"
              refId: A
              round: 0s
              showFormattedSQL: true
              skip_comments: true
              table: otel_metrics_sum
              useWindowFuncForMacros: true
          title: Active Clients - Playground
          type: table
    preload: false
    schemaVersion: 41
    tags: []
    templating:
        list: []
    time:
        from: now-24h
        to: now
    timepicker: {}
    timezone: browser
    title: Client Activity
    uid: 61fe100b-668c-4f1d-a65d-126c9e5af16e
